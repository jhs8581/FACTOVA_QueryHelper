<Window x:Class="FACTOVA_Palletizing_Analysis.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:FACTOVA_Palletizing_Analysis"
        mc:Ignorable="d"
        Title="FACTOVA Palletizing Analysis" Height="700" Width="1200">
    <Grid>
        <TabControl x:Name="MainTabControl" Margin="10">
            <!-- 로그분석 탭 -->
            <TabItem Header="로그분석">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Excel 파일 업로드 및 설정 -->
                    <GroupBox Header="Excel 쿼리 파일 설정" Grid.Row="0" Padding="10" Margin="0,0,0,10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- 파일 선택 -->
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="Excel 파일:" VerticalAlignment="Center" Grid.Column="0" Margin="0,0,10,0"/>
                                <TextBox x:Name="ExcelFilePathTextBox" Grid.Column="1" Margin="5" 
                                         IsReadOnly="True" VerticalAlignment="Center"/>
                                <Button x:Name="BrowseExcelButton" Grid.Column="2" Content="찾아보기..." 
                                        Width="100" Height="30" Margin="5"
                                        Click="BrowseExcelButton_Click"/>
                            </Grid>

                            <!-- 시트 및 시작 행 설정 -->
                            <Grid Grid.Row="1" Margin="0,10,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="200"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="시트:" VerticalAlignment="Center" Grid.Column="0" Margin="0,0,10,0"/>
                                <ComboBox x:Name="SheetComboBox" Grid.Column="1" Margin="5" VerticalAlignment="Center"/>

                                <TextBlock Text="시작 행:" VerticalAlignment="Center" Grid.Column="2" Margin="20,0,10,0"/>
                                <TextBox x:Name="StartRowTextBox" Grid.Column="3" Margin="5" Text="2" VerticalAlignment="Center"
                                         ToolTip="데이터 시작 행 번호 (헤더 제외)"/>

                                <TextBlock Text="(헤더 행 제외)" VerticalAlignment="Center" Grid.Column="4" Margin="10,0,10,0" 
                                           FontSize="11" Foreground="Gray"/>
                            </Grid>

                            <!-- 열 매핑 정보 안내 (접을 수 있는 형태) -->
                            <Expander Grid.Row="2" Margin="0,10,0,0" 
                                      IsExpanded="False"
                                      BorderBrush="#FF0078D7" 
                                      BorderThickness="1">
                                <Expander.Header>
                                    <TextBlock Text="📋 Excel 열 구조 (고정) - 클릭하여 펼치기/접기" 
                                               FontWeight="Bold" 
                                               Foreground="#FF0078D7"/>
                                </Expander.Header>
                                <Border Background="#FFF0F8FF" 
                                        Padding="15"
                                        CornerRadius="0,0,5,5">
                                    <TextBlock FontSize="11" LineHeight="18">
                                        <Run Text="• A열: TNS 이름 (예: GM2MRSP)"/><LineBreak/>
                                        <Run Text="• B열: User ID (DB 계정)"/><LineBreak/>
                                        <Run Text="• C열: Password (DB 비밀번호)"/><LineBreak/>
                                        <Run Text="• D열: 탭 이름 (결과 탭에 표시될 이름)"/><LineBreak/>
                                        <Run Text="• F열: SQL 쿼리"/><LineBreak/>
                                        <Run Text="• G열: 실행 여부 (Y/N, 빈 값은 Y로 간주)"/><LineBreak/>
                                        <Run Text="• H열: 알림 여부 (Y/N)"/><LineBreak/>
                                        <Run Text="• I열: 이상 건수 (N건 이상일 때 알림)"/><LineBreak/>
                                        <Run Text="• J열: 같음 건수 (정확히 N건일 때 알림)"/><LineBreak/>
                                        <Run Text="• K열: 이하 건수 (N건 이하일 때 알림)"/><LineBreak/>
                                        <Run Text="• L열: 컬럼명 (쉼표로 구분)"/><LineBreak/>
                                        <Run Text="• M열: 컬럼값 (쉼표로 구분)"/><LineBreak/>
                                        <Run Text="• N열: 제외 여부 (N이면 로드 시 제외)"/>
                                    </TextBlock>
                                </Border>
                            </Expander>

                            <!-- 쿼리 로드 및 실행 버튼 -->
                            <StackPanel Orientation="Horizontal" Grid.Row="3" Margin="0,10,0,0">
                                <Button x:Name="LoadQueriesButton" Content="쿼리 로드" 
                                        Width="100" Height="30" Margin="5,0,10,0"
                                        Click="LoadQueriesButton_Click"
                                        Background="#FF0078D7" 
                                        Foreground="White"
                                        FontWeight="Bold"
                                        IsEnabled="False"/>
                        
                                <TextBlock Text="로드된 쿼리:" VerticalAlignment="Center" Margin="10,0,10,0"/>
                                <TextBlock x:Name="LoadedQueriesTextBlock" Text="0개" VerticalAlignment="Center" 
                                           FontWeight="Bold" Foreground="#FF0078D7"/>
                                           
                                <Button x:Name="ExecuteAllButton" Content="전체 쿼리 실행" 
                                        Width="120" Height="30" Margin="20,0,10,0"
                                        Click="ExecuteAllButton_Click"
                                        Background="#FF28A745" 
                                        Foreground="White"
                                        FontWeight="Bold"
                                        IsEnabled="False"/>
                                        
                                <Button x:Name="ClearResultsButton" Content="결과 초기화" 
                                        Width="100" Height="30" Margin="5,0,10,0"
                                        Click="ClearResultsButton_Click"/>
                                        
                                <Separator Width="1" Margin="10,0"/>
                                
                                <TextBlock Text="주기 실행:" VerticalAlignment="Center" Margin="10,0,10,0"/>
                                <TextBox x:Name="QueryIntervalTextBox" Width="60" Text="60" VerticalAlignment="Center"
                                         ToolTip="쿼리 실행 주기 (초)"/>
                                <TextBlock Text="초" VerticalAlignment="Center" Margin="5,0,10,0"/>
                                
                                <Button x:Name="StartAutoQueryButton" Content="자동 실행 시작" 
                                        Width="120" Height="30" Margin="5,0,5,0"
                                        Click="StartAutoQueryButton_Click"
                                        Background="#FF0078D7" 
                                        Foreground="White"
                                        FontWeight="Bold"
                                        IsEnabled="False"/>
                                        
                                <Button x:Name="StopAutoQueryButton" Content="자동 실행 중지" 
                                        Width="120" Height="30" Margin="5,0,0,0"
                                        Click="StopAutoQueryButton_Click"
                                        Background="#FFDC3545" 
                                        Foreground="White"
                                        FontWeight="Bold"
                                        IsEnabled="False"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!-- 쿼리 결과 탭 -->
                    <GroupBox Header="쿼리 결과" Grid.Row="1" Padding="10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TabControl x:Name="ResultTabControl" Grid.Row="0">
                                <!-- 결과 탭들이 동적으로 추가됩니다 -->
                            </TabControl>

                            <TextBlock x:Name="StatusTextBlock" 
                                       Grid.Row="1" 
                                       Margin="0,5,0,0" 
                                       FontSize="11"
                                       Foreground="Gray"/>
                        </Grid>
                    </GroupBox>
                </Grid>
            </TabItem>

            <!-- SFC 모니터링 탭 -->
            <TabItem Header="SFC 모니터링">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 설정 영역 (Expander) -->
                    <Expander Grid.Row="0" Margin="0,0,0,10" 
                              IsExpanded="True"
                              BorderBrush="#FF0078D7" 
                              BorderThickness="1">
                        <Expander.Header>
                            <TextBlock Text="⚙️ 모니터링 설정 - 클릭하여 펼치기/접기" 
                                       FontWeight="Bold" 
                                       FontSize="13"
                                       Foreground="#FF0078D7"/>
                        </Expander.Header>
                        
                        <Border Background="#FFF8F9FA" 
                                Padding="15"
                                CornerRadius="0,0,5,5">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- TNS 및 날짜 선택 -->
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="TNS:" VerticalAlignment="Center" Grid.Column="0" Margin="0,0,10,0"/>
                                    <ComboBox x:Name="SfcTnsComboBox" Grid.Column="1" Margin="5" VerticalAlignment="Center"/>

                                    <TextBlock Text="조회 날짜:" VerticalAlignment="Center" Grid.Column="2" Margin="20,0,10,0"/>
                                    <DatePicker x:Name="ConfigDatePicker" Grid.Column="3" Margin="5" VerticalAlignment="Center"/>

                                    <TextBlock Text="User ID:" VerticalAlignment="Center" Grid.Column="4" Margin="20,0,10,0"/>
                                    <TextBox x:Name="SfcUserIdTextBox" Grid.Column="5" Margin="5" VerticalAlignment="Center"
                                             ToolTip="Oracle 사용자 ID"/>

                                    <TextBlock Text="Password:" VerticalAlignment="Center" Grid.Column="6" Margin="20,0,10,0"/>
                                    <PasswordBox x:Name="SfcPasswordBox" Grid.Column="7" Margin="5" VerticalAlignment="Center"
                                                 ToolTip="Oracle 비밀번호"/>
                                </Grid>

                                <!-- 쿼리 입력 -->
                                <Grid Grid.Row="1" Margin="0,10,0,0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <DockPanel Grid.Row="0" Margin="0,0,0,5">
                                        <TextBlock Text="쿼리" FontWeight="Bold" Margin="0,0,10,0" VerticalAlignment="Center" DockPanel.Dock="Left"/>
                                        <Button x:Name="ResetSfcQueryButton" Content="초기화" 
                                                Width="80" Height="25" 
                                                Click="ResetSfcQueryButton_Click"
                                                HorizontalAlignment="Right"
                                                DockPanel.Dock="Right"/>
                                    </DockPanel>
                                    
                                    <TextBox x:Name="SfcQueryTextBox" 
                                             Grid.Row="1"
                                             TextWrapping="Wrap" 
                                             AcceptsReturn="True"
                                             VerticalScrollBarVisibility="Auto"
                                             Height="80"
                                             FontFamily="Consolas"
                                             Text="SELECT * FROM TB_SFC_MAINFRAME_CONFIG_N A WHERE A.TRANSACTION_TYPE_CODE = 'LOGIN_AUTO' AND SFC_MODE = 'PROD' AND A.CONFIG_REGISTER_YMD = @CONFIG_REGISTER_YMD AND PC_IP_ADDR IN (@PC_IP_ADDR)"/>
                                </Grid>

                                <!-- Excel 파일 선택 및 조회 버튼 -->
                                <Grid Grid.Row="2" Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="Excel 파일:" VerticalAlignment="Center" Grid.Column="0" Margin="0,0,10,0"/>
                                    <TextBox x:Name="SfcExcelFilePathTextBox" Grid.Column="1" Margin="5" 
                                             IsReadOnly="True" VerticalAlignment="Center"/>
                                    <Button x:Name="BrowseSfcExcelButton" Grid.Column="2" Content="찾아보기..." 
                                            Width="100" Height="30" Margin="5"
                                            Click="BrowseSfcExcelButton_Click"/>
                                    <Button x:Name="LoadSfcExcelButton" Grid.Column="3" Content="Excel 로드" 
                                            Width="100" Height="30" Margin="5"
                                            Click="LoadSfcExcelButton_Click"
                                            Background="#FF0078D7" 
                                            Foreground="White"
                                            FontWeight="Bold"
                                            IsEnabled="False"/>
                                    <Button x:Name="ExecuteSfcQueryButton" Grid.Column="4" Content="쿼리 조회" 
                                            Width="100" Height="30" Margin="5"
                                            Click="ExecuteSfcQueryButton_Click"
                                            Background="#FF28A745" 
                                            Foreground="White"
                                            FontWeight="Bold"
                                            IsEnabled="False"/>
                                </Grid>
                            </Grid>
                        </Border>
                    </Expander>

                    <!-- 필터링 영역 -->
                    <GroupBox Header="필터링" Grid.Row="1" Padding="10" Margin="0,0,0,10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- 첫 번째 줄 -->
                            <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,5">
                                <TextBlock Text="IP 주소:" VerticalAlignment="Center" Width="80" Margin="0,0,5,0"/>
                                <TextBox x:Name="FilterIpTextBox" Width="120" Margin="5" VerticalAlignment="Center"
                                         TextChanged="ApplyFilter"
                                         ToolTip="IP 주소로 필터링 (부분 일치)"/>

                                <TextBlock Text="설비 ID:" VerticalAlignment="Center" Width="80" Margin="20,0,5,0"/>
                                <TextBox x:Name="FilterEquipmentIdTextBox" Width="120" Margin="5" VerticalAlignment="Center"
                                         TextChanged="ApplyFilter"
                                         ToolTip="설비 ID로 필터링 (부분 일치)"/>

                                <TextBlock Text="설비명:" VerticalAlignment="Center" Width="80" Margin="20,0,5,0"/>
                                <TextBox x:Name="FilterEquipmentNameTextBox" Width="150" Margin="5" VerticalAlignment="Center"
                                         TextChanged="ApplyFilter"
                                         ToolTip="설비명으로 필터링 (부분 일치)"/>
                            </StackPanel>

                            <!-- 두 번째 줄 -->
                            <StackPanel Orientation="Horizontal" Grid.Row="1">
                                <TextBlock Text="상태:" VerticalAlignment="Center" Width="80" Margin="0,0,5,0"/>
                                <ComboBox x:Name="FilterStatusComboBox" Width="200" Margin="5" VerticalAlignment="Center"
                                          IsEditable="True"
                                          IsReadOnly="True"
                                          DropDownClosed="ApplyFilter">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <CheckBox Content="{Binding Text}" 
                                                      IsChecked="{Binding IsChecked, Mode=TwoWay}"
                                                      Checked="FilterCheckBox_Changed"
                                                      Unchecked="FilterCheckBox_Changed"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>

                                <TextBlock Text="BIZACTOR:" VerticalAlignment="Center" Width="80" Margin="20,0,5,0"/>
                                <ComboBox x:Name="FilterBizActorComboBox" Width="200" Margin="5" VerticalAlignment="Center"
                                          IsEditable="True"
                                          IsReadOnly="True"
                                          DropDownClosed="ApplyFilter">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <CheckBox Content="{Binding Text}" 
                                                      IsChecked="{Binding IsChecked, Mode=TwoWay}"
                                                      Checked="FilterCheckBox_Changed"
                                                      Unchecked="FilterCheckBox_Changed"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>

                                <Button x:Name="ClearFilterButton" Content="필터 초기화" 
                                        Width="100" Height="25" Margin="20,0,0,0"
                                        Click="ClearFilterButton_Click"/>

                                <TextBlock x:Name="FilterStatusTextBlock" 
                                           VerticalAlignment="Center" 
                                           Margin="20,0,0,0"
                                           FontSize="11"
                                           Foreground="Gray"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!-- 결과 그리드 -->
                    <GroupBox Header="모니터링 결과" Grid.Row="2" Padding="10">
                        <DataGrid x:Name="SfcMonitorDataGrid" 
                                  AutoGenerateColumns="False" 
                                  IsReadOnly="True"
                                  GridLinesVisibility="All"
                                  AlternatingRowBackground="LightGray"
                                  CanUserAddRows="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="IP 주소" Binding="{Binding IpAddress}" Width="150"/>
                                <DataGridTextColumn Header="설비 ID" Binding="{Binding EquipmentId}" Width="150"/>
                                <DataGridTextColumn Header="설비명" Binding="{Binding EquipmentName}" Width="200"/>
                                <DataGridTextColumn Header="상태" Binding="{Binding Status}" Width="100"/>
                                <DataGridTextColumn Header="BIZACTOR" Binding="{Binding BizActor}" Width="100">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <Trigger Property="Text" Value="RPT">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>
                </Grid>
            </TabItem>

            <!-- 설정 탭 -->
            <TabItem Header="설정">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <GroupBox Header="TNS 파일 경로 설정" Grid.Row="0" Padding="15">
                        <StackPanel>
                            <TextBlock Text="tnsnames.ora 파일 경로" FontWeight="Bold" Margin="0,0,0,10"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBox x:Name="TnsPathTextBox" 
                                         Grid.Column="0"
                                         VerticalAlignment="Center" 
                                         Margin="0,0,10,0"
                                         IsReadOnly="True"/>
                                
                                <Button x:Name="BrowseButton" 
                                        Grid.Column="1"
                                        Content="찾아보기..." 
                                        Width="100" 
                                        Height="30"
                                        Click="BrowseButton_Click"/>
                            </Grid>

                            <TextBlock Text="기본 경로:" Margin="0,15,0,5" FontSize="11" Foreground="Gray"/>
                            <TextBlock x:Name="DefaultPathTextBlock" 
                                       FontSize="11" 
                                       Foreground="Gray" 
                                       TextWrapping="Wrap"/>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                                <Button x:Name="ResetButton" 
                                        Content="기본값 복원" 
                                        Width="100" 
                                        Height="30" 
                                        Margin="0,0,10,0"
                                        Click="ResetButton_Click"/>
                                <Button x:Name="SaveSettingsButton" 
                                        Content="설정 저장" 
                                        Width="100" 
                                        Height="30"
                                        Background="#FF0078D7" 
                                        Foreground="White"
                                        FontWeight="Bold"
                                        Click="SaveSettingsButton_Click"/>
                            </StackPanel>
                        </StackPanel>
                    </GroupBox>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
