<UserControl x:Class="FACTOVA_QueryHelper.Controls.QueryManagementControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1200"
             Background="White">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 상단 버튼 영역 -->
        <GroupBox Header="데이터베이스 관리" Grid.Row="0" Padding="10" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal">
                <Button x:Name="LoadFromDbButton" Content="🔄 새로고침" 
                        Width="120" Height="30" Margin="0,0,10,0"
                        Click="LoadFromDbButton_Click"
                        Background="#FF0078D7" 
                        Foreground="White"
                        FontWeight="Bold"
                        ToolTip="데이터베이스에서 쿼리 목록을 다시 로드합니다"/>
                
                <Separator Width="1" Background="#FFCCCCCC" Margin="10,0"/>
                
                <Button x:Name="AddQueryButton" Content="➕ 쿼리 추가" 
                        Width="110" Height="30" Margin="0,0,10,0"
                        Click="AddQueryButton_Click"
                        Background="#FF28A745" 
                        Foreground="White"
                        FontWeight="Bold"
                        ToolTip="새 쿼리를 직접 추가합니다"/>
                
                <Button x:Name="EditQueryButton" Content="✏️ 수정" 
                        Width="100" Height="30" Margin="0,0,10,0"
                        Click="EditQueryButton_Click"
                        IsEnabled="False"
                        Background="#FFFFC107"
                        ToolTip="선택한 쿼리를 수정합니다"/>
                
                <Button x:Name="DeleteQueryButton" Content="🗑️ 삭제" 
                        Width="100" Height="30" Margin="0,0,20,0"
                        Click="DeleteQueryButton_Click"
                        IsEnabled="False"
                        Background="#FFDC3545" 
                        Foreground="White"
                        ToolTip="선택한 쿼리를 삭제합니다"/>
                
                <Separator Width="20" Background="Transparent"/>
                
                <TextBlock Text="DB 쿼리 수:" VerticalAlignment="Center" Margin="0,0,10,0" FontWeight="Bold"/>
                <TextBlock x:Name="DbQueryCountTextBlock" Text="0개" 
                           VerticalAlignment="Center" 
                           FontWeight="Bold" 
                           Foreground="#FF28A745"
                           FontSize="16"/>
            </StackPanel>
        </GroupBox>

        <!-- 쿼리 목록 DataGrid -->
        <GroupBox Header="쿼리 목록 (셀 더블클릭: 편집 | Ctrl+C: 복사)" Grid.Row="1" Padding="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- 편집 중 안내 -->
                <Border Grid.Row="0" Background="#FFFFF3CD" Padding="10,5" Margin="0,0,0,10"
                        x:Name="EditModeBorder" Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ℹ️ 편집 중입니다. " FontWeight="Bold" VerticalAlignment="Center"/>
                        <TextBlock Text="필드를 수정한 후 " VerticalAlignment="Center"/>
                        <Button x:Name="SaveEditButton" Content="💾 변경사항 저장" 
                                Width="120" Height="25" Margin="5,0"
                                Click="SaveEditButton_Click"
                                Background="#FF28A745" 
                                Foreground="White"
                                FontWeight="Bold"/>
                        <TextBlock Text=" 또는 " VerticalAlignment="Center"/>
                        <Button x:Name="CancelEditButton" Content="❌ 취소" 
                                Width="70" Height="25" Margin="5,0"
                                Click="CancelEditButton_Click"/>
                        <TextBlock Text="을 클릭하세요." VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
                
                <DataGrid x:Name="QueriesDataGrid" 
                          Grid.Row="1"
                          AutoGenerateColumns="False"
                          SelectionMode="Single"
                          CanUserSortColumns="True"
                          CanUserResizeColumns="True"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          AlternatingRowBackground="#FFF0F8FF"
                          GridLinesVisibility="All"
                          HeadersVisibility="All"
                          SelectionChanged="QueriesDataGrid_SelectionChanged"
                          BeginningEdit="QueriesDataGrid_BeginningEdit"
                          CellEditEnding="QueriesDataGrid_CellEditEnding"
                          FontSize="11">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding RowNumber}" Width="50" IsReadOnly="True"/>
                        <DataGridTextColumn Header="쿼리명" Binding="{Binding QueryName, UpdateSourceTrigger=PropertyChanged}" Width="200"/>
                        <DataGridTextColumn Header="TNS" Binding="{Binding TnsName, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                        <DataGridTextColumn Header="Host" Binding="{Binding Host, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                        <DataGridTextColumn Header="Port" Binding="{Binding Port, UpdateSourceTrigger=PropertyChanged}" Width="60"/>
                        <DataGridTextColumn Header="Service" Binding="{Binding ServiceName, UpdateSourceTrigger=PropertyChanged}" Width="100"/>
                        <DataGridTextColumn Header="User ID" Binding="{Binding UserId, UpdateSourceTrigger=PropertyChanged}" Width="100"/>
                        
                        <!-- Password 컬럼 - 일반 텍스트로 변경 (편집 가능) -->
                        <DataGridTextColumn Header="Password" Binding="{Binding Password, UpdateSourceTrigger=PropertyChanged}" Width="100">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="********"/>
                                    <Setter Property="Foreground" Value="Gray"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        
                        <!-- 쿼리 컬럼 - 버튼으로 편집 -->
                        <DataGridTemplateColumn Header="SQL 쿼리" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="📝 쿼리 편집" 
                                            Click="EditQueryButton_InGrid_Click"
                                            Tag="{Binding}"
                                            HorizontalAlignment="Stretch"
                                            ToolTip="클릭하여 쿼리 편집"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        
                        <DataGridCheckBoxColumn Header="실행" Binding="{Binding EnabledFlagBool, UpdateSourceTrigger=PropertyChanged}" Width="50"/>
                        <DataGridCheckBoxColumn Header="알림" Binding="{Binding NotifyFlagBool, UpdateSourceTrigger=PropertyChanged}" Width="50"/>
                        <DataGridTextColumn Header="≥건수" Binding="{Binding CountGreaterThan, UpdateSourceTrigger=PropertyChanged}" Width="60"/>
                        <DataGridTextColumn Header="=건수" Binding="{Binding CountEquals, UpdateSourceTrigger=PropertyChanged}" Width="60"/>
                        <DataGridTextColumn Header="≤건수" Binding="{Binding CountLessThan, UpdateSourceTrigger=PropertyChanged}" Width="60"/>
                        <DataGridTextColumn Header="컬럼명" Binding="{Binding ColumnNames, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                        <DataGridTextColumn Header="컬럼값" Binding="{Binding ColumnValues, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                        <DataGridCheckBoxColumn Header="포함" Binding="{Binding ExcludeFlagBool, UpdateSourceTrigger=PropertyChanged}" Width="50"/>
                        <DataGridCheckBoxColumn Header="디폴트" Binding="{Binding DefaultFlagBool, UpdateSourceTrigger=PropertyChanged}" Width="60"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </GroupBox>

        <!-- 하단 상태바 -->
        <Border Grid.Row="2" BorderBrush="#FFCCCCCC" BorderThickness="0,1,0,0" Padding="10,5" Background="#FFF5F5F5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock x:Name="StatusTextBlock" 
                           Grid.Column="0"
                           Text="준비됨" 
                           FontSize="11"
                           Foreground="Gray"
                           VerticalAlignment="Center"/>
                
                <Button x:Name="ViewDbPathButton" 
                        Grid.Column="1"
                        Content="📂 DB 파일 위치" 
                        Width="120" Height="25"
                        Click="ViewDbPathButton_Click"
                        ToolTip="데이터베이스 파일 위치를 확인합니다"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
